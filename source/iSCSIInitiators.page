Menu="iSCSITools:3"
Title="Initiators"
Tag="save"
---
<?PHP
/* Copyright 2020-2020, Simon Fairweather
 * 
 * This program is free software; you can redistribute it and/or
 * modify it under the terms of the GNU General Public License version 2,
 * as published by the Free Software Foundation.
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 */
$plugin = "unraid.iSCSI";
$docroot = $docroot ?? $_SERVER['DOCUMENT_ROOT'] ?: '/usr/local/emhttp';
$translations = file_exists("$docroot/webGui/include/Translations.php");
require_once "$docroot/plugins/$plugin/include/Legacy.php";
?>
<?if (! $translations):?>
<?eval('?>'.parse_file("$docroot/plugins/$plugin/iSCSIInitiators.page"))?>
<?else:?>
<?
/* read translations */
parse_plugin('unraidiscsi');
?>

<style>
table.pre{margin-top:0;background:transparent}
table.pre td:first-child{width:144px}
table tr td{padding:0 0 3px 0;margin:0}
table tr td.thin{line-height:8px;height:8px}
</style>


<script>
$(function(){
$('#it1').load('/plugins/unraid.iSCSI/include/ISCSI.php',{table:'it1'});
$('#it2').load('/plugins/unraid.iSCSI/include/ISCSI.php',{table:'it2'});
});
function addLUN() {
  document.getElementById("warningLUN").innerHTML = "<b>_(Add Function not Implemented for LUNs)_.</b>";
  var message = "_(System Devices)_: _(A reboot is required to apply changes)_";
  var elements = document.getElementById("iscsidev").elements;
  var string ="" ;
  for (var i = 0, element; element = elements[i++];) {
    if (element.type === "checkbox" && element.value !=="" )
    string = string + element.value +';'+ element.checked +";";
  }

  $.get( "/plugins/unraid.iSCSI/include/blockdevice.php", { cfg: string } )
  .done(function(d) {
    if (d==1) {
      addRebootNotice(message);
      document.getElementById("warningDev").innerHTML = "<b>_(ALERT)_: _(Changes saved)_. _(Reboot to take effect)_.</b>";
    } else {
      removeRebootNotice(message);
      document.getElementById("warningDev").innerHTML = "<b>_(No changes)_.</b>";
    }
  });
}
function removeLUN() {
  var elements = document.getElementById("iscsiluns").elements;
  var string ="/plugins/unraid.iSCSI/include/removeLUN.php?more=1&LUNS=" ;
  for (var i = 0, element; element = elements[i++];) {
    if (element.type === "checkbox" && element.value !=="" )
    string = string + element.value +';'+ element.checked +";";
  }
  var tgt = document.getElementById("targetname").value;
  var someValue = document.getElementById("targetname").innerHTML;
  string = string + "&tgt=" + someValue  ;
  openBox(string,"_(Remove LUNs)_",600,600) ;
 }

 function removeInitMap() {
  var elements = document.getElementById("iscsiinits").elements;
  var string ="/plugins/unraid.iSCSI/include/removeInitMap.php?more=1&INIT=" ;
  for (var i = 0, element; element = elements[i++];) {
    if (element.type === "checkbox" && element.value !=="" )
    string = string + element.value +';'+ element.checked +";";
  }
  var tgt = document.getElementById("targetname").value;
  var someValue = document.getElementById("targetname").innerHTML;
  string = string + "&tgt=" + someValue  ;
  openBox(string,"_(Remove Initiators and Maps)_",600,600) ;
  }
 
function testLUN() {
  document.getElementById("warningLUN").innerHTML = "<b>_(Remove Function not Implemented for LUNs)_.</b>";
  openBox("/webGui/include/SystemInformation.php?more=<?=isset($display['sysinfo'])?$display['sysinfo']:''?>","_(System Information)_",600,600);
  var message = "_(System Devices)_: _(A reboot is required to apply changes)_";
  var elements = document.getElementById("iscsidev").elements;
  var string ="" ;
  for (var i = 0, element; element = elements[i++];) {
    if (element.type === "checkbox" && element.value !=="" )
    string = string + element.value +';'+ element.checked +";";
    parent.window.location.reload();
  }
  

  $.get( "/plugins/unraid.iSCSI/include/blockdevice.php", { cfg: string } )
  .done(function(d) {
    if (d==1) {
      addRebootNotice(message);
      document.getElementById("warningDev").innerHTML = "<b>_(ALERT)_: _(Changes saved)_. _(Reboot to take effect)_.</b>";
    } else {
      removeRebootNotice(message);
      document.getElementById("warningDev").innerHTML = "<b>_(No changes)_.</b>";
    }
  });
}
</script>


_(Target Name:)_<p><pre><form id="iscsitgt"> <span id='targetname' class='pre'></span> </form><pre></p>

_(Initiators)_

<pre><form id="iscsiinits" onsubmit="return false"><table id='it1' class='pre'><tr><td><div class="spinner"></div></td></tr></table></form></pre><br>

_(LUNS)_

<pre><form id="iscsiluns" onsubmit="return false"><table id='it2' class='pre'><tr><td><div class="spinner"></div></td></tr></table></form></pre><br>

<input type="button" value="_(Done)_" onclick="done()">
<?endif;?>